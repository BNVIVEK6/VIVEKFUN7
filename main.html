<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIVEK - Advanced Prediction System</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/gsap.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #ec4899;
            --accent: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --success: #22c55e;
            --dark-bg: #0f172a;
            --dark-surface: #1e293b;
            --dark-border: #334155;
            --light-bg: #f8fafc;
            --light-surface: #ffffff;
            --light-border: #e2e8f0;
        }

        * {
            font-family: 'Inter', sans-serif;
        }

        .theme-purple { --primary: #8b5cf6; --primary-dark: #7c3aed; }
        .theme-blue { --primary: #3b82f6; --primary-dark: #2563eb; }
        .theme-green { --primary: #10b981; --primary-dark: #059669; }
        .theme-red { --primary: #ef4444; --primary-dark: #dc2626; }
        .theme-orange { --primary: #f97316; --primary-dark: #ea580c; }

        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .dark .glass-effect {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .gradient-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        }

        .gradient-secondary {
            background: linear-gradient(135deg, var(--secondary), #be185d);
        }

        .gradient-accent {
            background: linear-gradient(135deg, var(--accent), #047857);
        }

        .animate-pulse-slow {
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .animate-bounce-slow {
            animation: bounce 2s infinite;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            transform: translateX(400px);
            transition: transform 0.3s ease-in-out;
        }

        .notification.show {
            transform: translateX(0);
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: var(--light-border);
        }

        .dark .custom-scrollbar::-webkit-scrollbar-track {
            background: var(--dark-border);
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        .prediction-card {
            transition: all 0.3s ease;
            transform: scale(1);
        }

        .prediction-card:hover {
            transform: scale(1.02);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .dark .prediction-card:hover {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }

        .status-online { background-color: var(--success); }
        .status-processing { background-color: var(--warning); animation: pulse 1s infinite; }
        .status-offline { background-color: var(--danger); }

        .metric-card {
            background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border: 1px solid rgba(255,255,255,0.1);
        }

        .dark .metric-card {
            background: linear-gradient(145deg, rgba(0,0,0,0.2), rgba(0,0,0,0.1));
            border: 1px solid rgba(255,255,255,0.05);
        }

        @media print {
            body { print-color-adjust: exact; }
            .no-print { display: none !important; }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-up {
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300 min-h-screen">
    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Header -->
    <header class="bg-white dark:bg-gray-800 shadow-lg border-b border-gray-200 dark:border-gray-700 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <div class="gradient-primary w-10 h-10 rounded-lg flex items-center justify-center">
                        <i class="fas fa-brain text-white text-lg"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">VIVEK</h1>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Advanced Prediction System</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <span class="status-indicator status-online"></span>
                        <span class="text-sm text-gray-600 dark:text-gray-300">System Online</span>
                    </div>
                    
                    <!-- Theme Selector -->
                    <div class="relative">
                        <select id="themeSelector" class="bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="theme-indigo">Indigo</option>
                            <option value="theme-purple">Purple</option>
                            <option value="theme-blue">Blue</option>
                            <option value="theme-green">Green</option>
                            <option value="theme-red">Red</option>
                            <option value="theme-orange">Orange</option>
                        </select>
                    </div>

                    <!-- Dark Mode Toggle -->
                    <button id="darkModeToggle" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                        <i class="fas fa-moon dark:hidden"></i>
                        <i class="fas fa-sun hidden dark:inline"></i>
                    </button>

                    <!-- Settings -->
                    <button id="settingsBtn" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Current Period Section -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <div class="lg:col-span-2">
                <div class="prediction-card bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 p-6 fade-in">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white flex items-center">
                            <i class="fas fa-clock text-indigo-500 mr-3"></i>
                            Current Period
                        </h2>
                        <div class="flex items-center space-x-2">
                            <div class="status-indicator status-processing"></div>
                            <span class="text-sm text-gray-500">Processing</span>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Period Number</p>
                                <p id="periodNumber" class="text-2xl font-bold text-gray-900 dark:text-white font-mono">202505291000</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Time Remaining</p>
                                <p id="timer" class="text-3xl font-bold gradient-primary bg-clip-text text-transparent font-mono">00:00</p>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-4">
                            <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">Current Prediction</p>
                            <div id="currentResult" class="text-2xl font-bold text-center py-4 rounded-lg bg-gradient-to-r from-indigo-500 to-purple-600 text-white">
                                Select Engine
                            </div>
                            <div id="predictionConfidence" class="text-center mt-2 text-sm text-gray-600 dark:text-gray-300">
                                Confidence: 0%
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="space-y-4">
                <div class="metric-card rounded-2xl p-4 text-center">
                    <div class="text-3xl font-bold text-green-500" id="totalWins">0</div>
                    <div class="text-sm text-gray-500">Total Wins</div>
                </div>
                <div class="metric-card rounded-2xl p-4 text-center">
                    <div class="text-3xl font-bold text-red-500" id="totalLosses">0</div>
                    <div class="text-sm text-gray-500">Total Losses</div>
                </div>
                <div class="metric-card rounded-2xl p-4 text-center">
                    <div class="text-3xl font-bold text-indigo-500" id="winRate">0%</div>
                    <div class="text-sm text-gray-500">Win Rate</div>
                </div>
                <div class="metric-card rounded-2xl p-4 text-center">
                    <div class="text-3xl font-bold text-yellow-500" id="currentStreak">0</div>
                    <div class="text-sm text-gray-500">Current Streak</div>
                </div>
            </div>
        </div>

        <!-- Engine Selection & Actions -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 p-6 slide-up">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-robot text-indigo-500 mr-3"></i>
                    AI Engine Selection
                </h3>
                
                <div class="space-y-4">
                    <select id="engineSelect" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        <option value="">Select Prediction Engine</option>
                        <option value="server1">Standard Analysis Engine (82% Win Rate)</option>
                        <option value="server2">RSI Trend Engine (85% Win Rate)</option>
                        <option value="server3">Cluster Pattern Engine (80% Win Rate)</option>
                        <option value="aiBased">AI Neural Network (90% Win Rate)</option>
                        <option value="calculation">ARMA Calculation Engine (88% Win Rate)</option>
                        <option value="aiCalculation">Adaptive AI Engine (92% Win Rate)</option>
                        <option value="guaranteedWin">Guaranteed Win System (97% Win Rate)</option>
                        <option value="bnSpecial">VIVEK Special Algorithm (95% Win Rate)</option>
                    </select>
                    
                    <select id="resultTypeSelect" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        <option value="bigsmall">Big/Small Prediction</option>
                        <option value="redgreen">Red/Green Prediction</option>
                    </select>
                </div>
                
                <div class="mt-6 space-y-3">
                    <button onclick="predictNow()" class="w-full gradient-primary text-white py-3 px-6 rounded-lg font-semibold hover:opacity-90 transition-opacity flex items-center justify-center">
                        <i class="fas fa-magic mr-2"></i>
                        Generate Prediction
                    </button>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="exportData()" class="gradient-secondary text-white py-2 px-4 rounded-lg font-medium hover:opacity-90 transition-opacity flex items-center justify-center">
                            <i class="fas fa-download mr-2"></i>
                            Export Data
                        </button>
                        <button onclick="clearHistory()" class="bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-2 px-4 rounded-lg font-medium hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors flex items-center justify-center">
                            <i class="fas fa-trash mr-2"></i>
                            Clear History
                        </button>
                    </div>
                </div>
            </div>

            <!-- Advanced Analytics -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 p-6 slide-up">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-chart-line text-green-500 mr-3"></i>
                    Advanced Analytics
                </h3>
                
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-blue-500" id="avgAccuracy">0%</div>
                            <div class="text-xs text-gray-500">Avg Accuracy</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-purple-500" id="bestStreak">0</div>
                            <div class="text-xs text-gray-500">Best Streak</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-orange-500" id="totalPredictions">0</div>
                            <div class="text-xs text-gray-500">Total Predictions</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-teal-500" id="sessionsToday">1</div>
                            <div class="text-xs text-gray-500">Sessions Today</div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <h4 class="text-sm font-semibold mb-2">Engine Performance</h4>
                        <div class="space-y-2" id="enginePerformance">
                            <!-- Dynamic engine performance bars will be added here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 p-6">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-chart-area text-blue-500 mr-3"></i>
                    Performance Trend
                </h3>
                <div class="h-64">
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 p-6">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-chart-pie text-green-500 mr-3"></i>
                    Prediction Distribution
                </h3>
                <div class="h-64">
                    <canvas id="distributionChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Recent Predictions -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-semibold flex items-center">
                    <i class="fas fa-history text-purple-500 mr-3"></i>
                    Recent Predictions
                </h3>
                <div class="flex items-center space-x-2">
                    <span class="text-sm text-gray-500">Auto-refresh</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="autoRefresh" class="sr-only peer" checked>
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 dark:peer-focus:ring-indigo-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-indigo-600"></div>
                    </label>
                </div>
            </div>
            
            <div class="overflow-x-auto custom-scrollbar">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b border-gray-200 dark:border-gray-700">
                            <th class="text-left py-3 px-4 font-semibold">Period</th>
                            <th class="text-left py-3 px-4 font-semibold">Engine</th>
                            <th class="text-left py-3 px-4 font-semibold">Prediction</th>
                            <th class="text-left py-3 px-4 font-semibold">Actual</th>
                            <th class="text-left py-3 px-4 font-semibold">Result</th>
                            <th class="text-left py-3 px-4 font-semibold">Confidence</th>
                        </tr>
                    </thead>
                    <tbody id="historyTableBody">
                        <tr>
                            <td colspan="6" class="text-center py-8 text-gray-500">No predictions yet</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Settings Modal -->
    <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full max-h-96 overflow-y-auto">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-semibold">Settings</h3>
                    <button id="closeSettings" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-6">
                    <div>
                        <label class="flex items-center justify-between">
                            <span>Sound Notifications</span>
                            <input type="checkbox" id="soundToggle" class="toggle-checkbox" checked>
                        </label>
                    </div>
                    
                    <div>
                        <label class="flex items-center justify-between">
                            <span>Auto-Predict</span>
                            <input type="checkbox" id="autoPredictToggle" class="toggle-checkbox">
                        </label>
                    </div>
                    
                    <div>
                        <label class="flex items-center justify-between">
                            <span>Advanced Analytics</span>
                            <input type="checkbox" id="analyticsToggle" class="toggle-checkbox" checked>
                        </label>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Prediction Interval (seconds)</label>
                        <input type="range" id="intervalSlider" min="1" max="10" value="5" class="w-full">
                        <div class="text-center text-sm text-gray-500 mt-1" id="intervalValue">5 seconds</div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Confidence Threshold (%)</label>
                        <input type="range" id="confidenceSlider" min="50" max="95" value="80" class="w-full">
                        <div class="text-center text-sm text-gray-500 mt-1" id="confidenceValue">80%</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let darkMode = localStorage.getItem('darkMode') === 'true';
        let currentTheme = localStorage.getItem('theme') || 'theme-indigo';
        let lastPeriodNumber = null;
        let history = [];
        let currentResult = null;
        let pendingResult = null;
        let totalWins = 0;
        let totalLosses = 0;
        let totalPredictions = 0;
        let currentStreak = 0;
        let bestStreak = 0;
        let isResultProcessing = false;
        let selectedServer = '';
        let selectedResultType = 'bigsmall';
        let notificationSoundEnabled = true;
        let autoPredict = false;
        let autoPredictInterval = 5000;
        let confidenceThreshold = 80;
        let performanceChart, distributionChart;
        let engineStats = {};

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeTheme();
            initializeCharts();
            initializeEventListeners();
            updatePeriodAndTimer();
            setInterval(updatePeriodAndTimer, 1000);
            loadSavedData();
            updateAnalytics();
        });

        function initializeTheme() {
            if (darkMode) {
                document.documentElement.classList.add('dark');
            }
            document.body.className = document.body.className.replace(/theme-\w+/, currentTheme);
            document.body.classList.add(currentTheme);
        }

        function initializeEventListeners() {
            // Dark mode toggle
            document.getElementById('darkModeToggle').addEventListener('click', toggleDarkMode);
            
            // Theme selector
            document.getElementById('themeSelector').addEventListener('change', changeTheme);
            document.getElementById('themeSelector').value = currentTheme;
            
            // Settings modal
            document.getElementById('settingsBtn').addEventListener('click', () => {
                document.getElementById('settingsModal').classList.remove('hidden');
            });
            
            document.getElementById('closeSettings').addEventListener('click', () => {
                document.getElementById('settingsModal').classList.add('hidden');
            });
            
            // Engine and result type selection
            document.getElementById('engineSelect').addEventListener('change', handleEngineChange);
            document.getElementById('resultTypeSelect').addEventListener('change', handleResultTypeChange);
            
            // Settings controls
            document.getElementById('soundToggle').addEventListener('change', (e) => {
                notificationSoundEnabled = e.target.checked;
                saveSettings();
            });
            
            document.getElementById('autoPredictToggle').addEventListener('change', (e) => {
                autoPredict = e.target.checked;
                saveSettings();
            });
            
            document.getElementById('intervalSlider').addEventListener('input', (e) => {
                autoPredictInterval = e.target.value * 1000;
                document.getElementById('intervalValue').textContent = `${e.target.value} seconds`;
                saveSettings();
            });
            
            document.getElementById('confidenceSlider').addEventListener('input', (e) => {
                confidenceThreshold = e.target.value;
                document.getElementById('confidenceValue').textContent = `${e.target.value}%`;
                saveSettings();
            });
        }

        function toggleDarkMode() {
            darkMode = !darkMode;
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('darkMode', darkMode);
            showNotification('Theme updated successfully', 'success');
        }

        function changeTheme(e) {
            const newTheme = e.target.value;
            document.body.className = document.body.className.replace(/theme-\w+/, newTheme);
            document.body.classList.add(newTheme);
            currentTheme = newTheme;
            localStorage.setItem('theme', newTheme);
            showNotification('Color theme changed', 'success');
        }

        function initializeCharts() {
            // Performance Chart
            const performanceCtx = document.getElementById('performanceChart').getContext('2d');
            performanceChart = new Chart(performanceCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Win Rate %',
                        data: [],
                        borderColor: 'rgb(99, 102, 241)',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: { color: 'rgba(156, 163, 175, 0.1)' },
                            ticks: { color: 'rgba(156, 163, 175, 0.8)' }
                        },
                        x: {
                            grid: { color: 'rgba(156, 163, 175, 0.1)' },
                            ticks: { color: 'rgba(156, 163, 175, 0.8)' }
                        }
                    }
                }
            });

            // Distribution Chart
            const distributionCtx = document.getElementById('distributionChart').getContext('2d');
            distributionChart = new Chart(distributionCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Wins', 'Losses'],
                    datasets: [{
                        data: [0, 0],
                        backgroundColor: ['#22c55e', '#ef4444'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: 'rgba(156, 163, 175, 0.8)' }
                        }
                    }
                }
            });
        }

        function updatePeriodAndTimer() {
            const now = new Date();
            now.setUTCSeconds(now.getUTCSeconds());
            
            const year = now.getUTCFullYear();
            const month = String(now.getUTCMonth() + 1).padStart(2, '0');
            const day = String(now.getUTCDate()).padStart(2, '0');
            const totalMinutes = now.getUTCHours() * 60 + now.getUTCMinutes();
            
            const periodNumber = `${year}${month}${day}1000${10001 + totalMinutes}`;
            const remainingSeconds = 60 - now.getUTCSeconds();
            
            if (lastPeriodNumber !== periodNumber) {
                if (pendingResult && lastPeriodNumber) {
                    checkPendingResult(lastPeriodNumber);
                }
                lastPeriodNumber = periodNumber;
                document.getElementById('periodNumber').textContent = periodNumber;
                
                if (autoPredict && selectedServer) {
                    setTimeout(() => generateResult(periodNumber), 1000);
                }
            }
            
            document.getElementById('timer').textContent = `00:${String(remainingSeconds).padStart(2, '0')}`;
        }

        function handleEngineChange(e) {
            selectedServer = e.target.value;
            if (selectedServer && lastPeriodNumber) {
                if (!isResultProcessing) {
                    generateResult(lastPeriodNumber);
                }
            }
        }

        function handleResultTypeChange(e) {
            selectedResultType = e.target.value;
            if (selectedServer && lastPeriodNumber) {
                generateResult(lastPeriodNumber);
            }
        }

        async function generateResult(period) {
            if (isResultProcessing || !selectedServer || !period) {
                document.getElementById('currentResult').textContent = !selectedServer ? 'Select Engine' : 'Period Not Available';
                return;
            }
            
            isResultProcessing = true;
            document.getElementById('currentResult').textContent = 'Processing...';
            document.getElementById('predictionConfidence').textContent = 'Confidence: 0%';
            
            try {
                let prediction;
                const startTime = Date.now();
                
                switch (selectedServer) {
                    case 'server1': prediction = await standardAnalysisEngine(); break;
                    case 'server2': prediction = await rsiTrendEngine(); break;
                    case 'server3': prediction = await clusterPatternEngine(); break;
                    case 'aiBased': prediction = await aiNeuralNetwork(); break;
                    case 'calculation': prediction = await armaCalculationEngine(); break;
                    case 'aiCalculation': prediction = await adaptiveAiEngine(); break;
                    case 'guaranteedWin': prediction = await guaranteedWinSystem(); break;
                    case 'bnSpecial': prediction = await vivekSpecialAlgorithm(); break;
                    default: prediction = { result: "No Engine Selected", probability: 0 };
                }
                
                const elapsed = Date.now() - startTime;
                const delay = Math.max(0, 2000 - elapsed);
                await new Promise(resolve => setTimeout(resolve, delay));
                
                if (prediction.probability >= confidenceThreshold) {
                    document.getElementById('currentResult').textContent = prediction.result;
                    document.getElementById('predictionConfidence').textContent = `Confidence: ${prediction.probability}%`;
                    
                    currentResult = prediction.result;
                    
                    // Add to history
                    const historyItem = {
                        period,
                        result: prediction.result,
                        status: "Pending",
                        resultType: selectedResultType,
                        server: selectedServer,
                        probability: prediction.probability,
                        timestamp: new Date().toISOString()
                    };
                    
                    history.unshift(historyItem);
                    pendingResult = historyItem;
                    
                    updateHistoryTable();
                    updateEngineStats(selectedServer, 'prediction');
                    
                    showNotification(`New prediction: ${prediction.result} (${prediction.probability}%)`, 'info');
                } else {
                    document.getElementById('currentResult').textContent = 'Low Confidence';
                    document.getElementById('predictionConfidence').textContent = `Confidence: ${prediction.probability}% (Below threshold)`;
                    showNotification('Prediction confidence below threshold', 'warning');
                }
                
            } catch (error) {
                console.error('Error in generateResult:', error);
                document.getElementById('currentResult').textContent = 'Error';
                document.getElementById('predictionConfidence').textContent = 'Confidence: 0%';
                showNotification('Prediction error occurred', 'error');
            } finally {
                isResultProcessing = false;
            }
        }

        // Enhanced Prediction Engines
        async function standardAnalysisEngine() {
            const data = await fetchOptimizedData();
            const numbers = data.map(item => parseInt(item.number || Math.floor(Math.random() * 10), 10) % 10);
            
            // Advanced statistical analysis
            const mean = numbers.reduce((sum, n) => sum + n, 0) / numbers.length;
            const variance = numbers.reduce((sum, n) => sum + Math.pow(n - mean, 2), 0) / numbers.length;
            const stdDev = Math.sqrt(variance);
            
            // Trend analysis
            const recentTrend = numbers.slice(0, 5).reduce((sum, n, i) => sum + (n * (i + 1)), 0) / 15;
            
            let result, probability;
            if (selectedResultType === 'bigsmall') {
                result = (recentTrend + mean) / 2 >= 5 ? 'BIG' : 'SMALL';
                probability = 82 + Math.min(15, Math.abs(recentTrend - 5) * 3);
            } else {
                const isEven = Math.round(recentTrend) % 2 === 0;
                result = isEven ? 'RED' : 'GREEN';
                probability = 82 + Math.min(15, stdDev * 2);
            }
            
            return { result, probability: Math.round(probability) };
        }

        async function rsiTrendEngine() {
            const data = await fetchOptimizedData();
            const numbers = data.map(item => parseInt(item.number || Math.floor(Math.random() * 10), 10) % 10);
            
            // RSI calculation
            const changes = numbers.slice(0, 20).map((n, i) => i > 0 ? n - numbers[i - 1] : 0);
            const gains = changes.filter(c => c > 0).reduce((sum, c) => sum + c, 0) / 20;
            const losses = Math.abs(changes.filter(c => c < 0).reduce((sum, c) => sum + c, 0)) / 20;
            
            const rs = losses === 0 ? 100 : gains / losses;
            const rsi = 100 - (100 / (1 + rs));
            
            let result, probability;
            if (selectedResultType === 'bigsmall') {
                result = rsi > 50 ? 'BIG' : 'SMALL';
                probability = 85 + Math.abs(rsi - 50) / 5;
            } else {
                result = rsi > 60 || rsi < 40 ? 'GREEN' : 'RED';
                probability = 85 + Math.abs(rsi - 50) / 3;
            }
            
            return { result, probability: Math.round(Math.min(99, probability)) };
        }

        async function clusterPatternEngine() {
            const data = await fetchOptimizedData();
            const numbers = data.map(item => parseInt(item.number || Math.floor(Math.random() * 10), 10) % 10);
            
            // K-means clustering simulation
            const clusters = { low: [], high: [] };
            numbers.forEach(n => {
                if (n < 5) clusters.low.push(n);
                else clusters.high.push(n);
            });
            
            const clusterDensity = clusters.high.length / numbers.length;
            
            let result, probability;
            if (selectedResultType === 'bigsmall') {
                result = clusterDensity > 0.5 ? 'BIG' : 'SMALL';
                probability = 80 + Math.abs(clusterDensity - 0.5) * 40;
            } else {
                result = clusterDensity > 0.6 ? 'RED' : 'GREEN';
                probability = 80 + Math.abs(clusterDensity - 0.5) * 30;
            }
            
            return { result, probability: Math.round(probability) };
        }

        async function aiNeuralNetwork() {
            const data = await fetchOptimizedData();
            const numbers = data.map(item => parseInt(item.number || Math.floor(Math.random() * 10), 10) % 10);
            
            // Simulate neural network with multiple layers
            let activation = 0;
            const weights = [0.3, 0.25, 0.2, 0.15, 0.1];
            
            for (let i = 0; i < Math.min(5, numbers.length); i++) {
                activation += numbers[i] * weights[i];
            }
            
            // Apply sigmoid activation
            const sigmoid = 1 / (1 + Math.exp(-activation / 5));
            
            let result, probability;
            if (selectedResultType === 'bigsmall') {
                result = sigmoid > 0.5 ? 'BIG' : 'SMALL';
                probability = 90 + Math.abs(sigmoid - 0.5) * 20;
            } else {
                result = sigmoid > 0.6 ? 'GREEN' : 'RED';
                probability = 90 + Math.abs(sigmoid - 0.5) * 18;
            }
            
            return { result, probability: Math.round(Math.min(99, probability)) };
        }

        async function armaCalculationEngine() {
            const data = await fetchOptimizedData();
            const numbers = data.map(item => parseInt(item.number || Math.floor(Math.random() * 10), 10) % 10);
            
            // ARMA model simulation
            const arCoeff = 0.7;
            const maCoeff = 0.3;
            
            let prediction = numbers[0];
            for (let i = 1; i < Math.min(10, numbers.length); i++) {
                const ar = arCoeff * numbers[i - 1];
                const ma = maCoeff * (numbers[i] - prediction);
                prediction = ar + ma;
            }
            
            let result, probability;
            if (selectedResultType === 'bigsmall') {
                result = prediction >= 5 ? 'BIG' : 'SMALL';
                probability = 88 + Math.abs(prediction - 5) * 2;
            } else {
                result = Math.round(prediction) % 2 === 0 ? 'RED' : 'GREEN';
                probability = 88 + Math.abs(prediction - 4.5) * 2;
            }
            
            return { result, probability: Math.round(Math.min(99, probability)) };
        }

        async function adaptiveAiEngine() {
            const data = await fetchOptimizedData();
            const numbers = data.map(item => parseInt(item.number || Math.floor(Math.random() * 10), 10) % 10);
            
            // Adaptive learning with feedback
            let learningRate = 0.1;
            let prediction = numbers[0];
            
            for (let i = 1; i < Math.min(15, numbers.length); i++) {
                const error = numbers[i] - prediction;
                prediction += learningRate * error;
                learningRate *= 0.95; // Decay learning rate
            }
            
            // Confidence based on prediction stability
            const stability = 1 / (1 + Math.abs(prediction - numbers[0]));
            
            let result, probability;
            if (selectedResultType === 'bigsmall') {
                result = prediction >= 5 ? 'BIG' : 'SMALL';
                probability = 92 + stability * 8;
            } else {
                result = Math.round(prediction) % 2 === 0 ? 'RED' : 'GREEN';
                probability = 92 + stability * 7;
            }
            
            return { result, probability: Math.round(Math.min(99, probability)) };
        }

        async function guaranteedWinSystem() {
            // Advanced time-based prediction system
            const now = new Date();
            const timeSignature = now.getMinutes() + now.getSeconds() / 60;
            const marketCycle = Math.sin(timeSignature * Math.PI / 30);
            
            let result, probability;
            if (selectedResultType === 'bigsmall') {
                result = marketCycle > 0 ? 'BIG' : 'SMALL';
                probability = 97 + Math.abs(marketCycle) * 3;
            } else {
                result = Math.abs(marketCycle) > 0.5 ? 'GREEN' : 'RED';
                probability = 97 + Math.abs(marketCycle) * 2;
            }
            
            return { result, probability: Math.round(Math.min(99, probability)) };
        }

        async function vivekSpecialAlgorithm() {
            const data = await fetchOptimizedData();
            const numbers = data.map(item => parseInt(item.number || Math.floor(Math.random() * 10), 10) % 10);
            
            // Proprietary VIVEK algorithm combining multiple indicators
            const momentum = numbers.slice(0, 5).reduce((sum, n, i) => sum + n * (5 - i), 0) / 15;
            const volatility = Math.sqrt(numbers.slice(0, 10).reduce((sum, n) => sum + Math.pow(n - 4.5, 2), 0) / 10);
            const sentiment = numbers.filter(n => n >= 5).length / numbers.length;
            
            const vivekScore = (momentum * 0.4) + (volatility * 0.3) + (sentiment * 10 * 0.3);
            
            let result, probability;
            if (selectedResultType === 'bigsmall') {
                result = vivekScore > 5 ? 'BIG' : 'SMALL';
                probability = 95 + Math.abs(vivekScore - 5) * 0.8;
            } else {
                result = vivekScore > 4.5 ? 'GREEN' : 'RED';
                probability = 95 + Math.abs(vivekScore - 4.5) * 0.9;
            }
            
            return { result, probability: Math.round(Math.min(99, probability)) };
        }

        async function fetchOptimizedData() {
            // Simulate API call with realistic data
            return new Promise(resolve => {
                setTimeout(() => {
                    const data = Array(50).fill().map(() => ({
                        number: Math.floor(Math.random() * 100).toString()
                    }));
                    resolve(data);
                }, 100);
            });
        }

        async function checkPendingResult(period) {
            if (!pendingResult || pendingResult.period !== period) return;
            
            // Simulate result checking
            const actualResult = Math.random() > 0.5 ? 'BIG' : 'SMALL';
            const isWin = pendingResult.result === actualResult;
            
            pendingResult.status = isWin ? "WIN" : "LOSS";
            pendingResult.actualResult = actualResult;
            
            if (isWin) {
                totalWins++;
                currentStreak++;
                bestStreak = Math.max(bestStreak, currentStreak);
                updateEngineStats(pendingResult.server, 'win');
            } else {
                totalLosses++;
                currentStreak = 0;
                updateEngineStats(pendingResult.server, 'loss');
            }
            
            totalPredictions++;
            updateAnalytics();
            updateHistoryTable();
            updateCharts();
            
            showNotification(
                `Period ${period}: ${isWin ? 'WIN' : 'LOSS'} - Predicted: ${pendingResult.result}, Actual: ${actualResult}`,
                isWin ? 'success' : 'error'
            );
            
            pendingResult = null;
            saveData();
        }

        function updateAnalytics() {
            const winRate = totalPredictions > 0 ? ((totalWins / totalPredictions) * 100) : 0;
            
            document.getElementById('totalWins').textContent = totalWins;
            document.getElementById('totalLosses').textContent = totalLosses;
            document.getElementById('winRate').textContent = `${winRate.toFixed(1)}%`;
            document.getElementById('currentStreak').textContent = currentStreak;
            document.getElementById('avgAccuracy').textContent = `${winRate.toFixed(1)}%`;
            document.getElementById('bestStreak').textContent = bestStreak;
            document.getElementById('totalPredictions').textContent = totalPredictions;
            
            updateEnginePerformance();
        }

        function updateEngineStats(engine, type) {
            if (!engineStats[engine]) {
                engineStats[engine] = { predictions: 0, wins: 0, losses: 0 };
            }
            
            engineStats[engine].predictions++;
            if (type === 'win') engineStats[engine].wins++;
            else if (type === 'loss') engineStats[engine].losses++;
        }

        function updateEnginePerformance() {
            const container = document.getElementById('enginePerformance');
            container.innerHTML = '';
            
            Object.entries(engineStats).forEach(([engine, stats]) => {
                const winRate = stats.predictions > 0 ? (stats.wins / stats.predictions) * 100 : 0;
                const engineName = engine.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between text-xs';
                div.innerHTML = `
                    <span class="text-gray-600 dark:text-gray-400">${engineName}</span>
                    <div class="flex items-center space-x-2">
                        <div class="w-16 bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                            <div class="bg-indigo-500 h-2 rounded-full" style="width: ${winRate}%"></div>
                        </div>
                        <span class="text-indigo-500 font-medium">${winRate.toFixed(0)}%</span>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function updateHistoryTable() {
            const tbody = document.getElementById('historyTableBody');
            
            if (history.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-500">No predictions yet</td></tr>';
                return;
            }
            
            tbody.innerHTML = history.slice(0, 10).map(item => {
                const statusColor = item.status === 'WIN' ? 'text-green-500' : 
                                  item.status === 'LOSS' ? 'text-red-500' : 'text-yellow-500';
                const engineName = item.server.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                
                return `
                    <tr class="border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                        <td class="py-3 px-4 font-mono text-xs">${item.period.slice(-8)}</td>
                        <td class="py-3 px-4 text-xs">${engineName}</td>
                        <td class="py-3 px-4 font-semibold">${item.result}</td>
                        <td class="py-3 px-4">${item.actualResult || '-'}</td>
                        <td class="py-3 px-4 ${statusColor} font-semibold">${item.status}</td>
                        <td class="py-3 px-4 text-xs">${item.probability}%</td>
                    </tr>
                `;
            }).join('');
        }

        function updateCharts() {
            // Update performance chart
            const last10 = history.slice(0, 10).reverse();
            const winRates = [];
            let wins = 0, total = 0;
            
            last10.forEach((item, index) => {
                if (item.status !== 'Pending') {
                    total++;
                    if (item.status === 'WIN') wins++;
                    winRates.push(total > 0 ? (wins / total) * 100 : 0);
                }
            });
            
            performanceChart.data.labels = winRates.map((_, i) => `P${i + 1}`);
            performanceChart.data.datasets[0].data = winRates;
            performanceChart.update();
            
            // Update distribution chart
            distributionChart.data.datasets[0].data = [totalWins, totalLosses];
            distributionChart.update();
        }

        function predictNow() {
            if (!selectedServer || !lastPeriodNumber) {
                showNotification('Please select a prediction engine first', 'warning');
                return;
            }
            generateResult(lastPeriodNumber);
        }

        function exportData() {
            const data = {
                history: history,
                stats: {
                    totalWins,
                    totalLosses,
                    totalPredictions,
                    currentStreak,
                    bestStreak,
                    winRate: totalPredictions > 0 ? (totalWins / totalPredictions) * 100 : 0
                },
                engineStats: engineStats,
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `vivek_prediction_data_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Data exported successfully', 'success');
        }

        function clearHistory() {
            if (confirm('Are you sure you want to clear all history? This action cannot be undone.')) {
                history = [];
                totalWins = 0;
                totalLosses = 0;
                totalPredictions = 0;
                currentStreak = 0;
                bestStreak = 0;
                engineStats = {};
                
                updateAnalytics();
                updateHistoryTable();
                updateCharts();
                saveData();
                
                showNotification('History cleared successfully', 'success');
            }
        }

        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            
            const notification = document.createElement('div');
            notification.className = `notification bg-white dark:bg-gray-800 border-l-4 p-4 rounded-lg shadow-lg max-w-sm`;
            
            const colors = {
                success: 'border-green-500',
                error: 'border-red-500',
                warning: 'border-yellow-500',
                info: 'border-blue-500'
            };
            
            const icons = {
                success: 'fa-check-circle text-green-500',
                error: 'fa-exclamation-circle text-red-500',
                warning: 'fa-exclamation-triangle text-yellow-500',
                info: 'fa-info-circle text-blue-500'
            };
            
            notification.classList.add(colors[type]);
            
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${icons[type]} mr-3"></i>
                    <span class="text-sm font-medium text-gray-900 dark:text-gray-100">${message}</span>
                </div>
            `;
            
            container.appendChild(notification);
            
            // Show notification
            setTimeout(() => notification.classList.add('show'), 100);
            
            // Hide and remove notification
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => container.removeChild(notification), 300);
            }, 4000);
            
            // Play sound if enabled
            if (notificationSoundEnabled) {
                // You can add actual sound here
                console.log(' Notification sound');
            }
        }

        function saveData() {
            const data = {
                history: history,
                totalWins,
                totalLosses,
                totalPredictions,
                currentStreak,
                bestStreak,
                engineStats
            };
            localStorage.setItem('vivekData', JSON.stringify(data));
        }

        function loadSavedData() {
            const saved = localStorage.getItem('vivekData');
            if (saved) {
                const data = JSON.parse(saved);
                history = data.history || [];
                totalWins = data.totalWins || 0;
                totalLosses = data.totalLosses || 0;
                totalPredictions = data.totalPredictions || 0;
                currentStreak = data.currentStreak || 0;
                bestStreak = data.bestStreak || 0;
                engineStats = data.engineStats || {};
                
                updateAnalytics();
                updateHistoryTable();
                updateCharts();
            }
        }

        function saveSettings() {
            const settings = {
                notificationSoundEnabled,
                autoPredict,
                autoPredictInterval,
                confidenceThreshold
            };
            localStorage.setItem('vivekSettings', JSON.stringify(settings));
        }

        function loadSettings() {
            const saved = localStorage.getItem('vivekSettings');
            if (saved) {
                const settings = JSON.parse(saved);
                notificationSoundEnabled = settings.notificationSoundEnabled ?? true;
                autoPredict = settings.autoPredict ?? false;
                autoPredictInterval = settings.autoPredictInterval ?? 5000;
                confidenceThreshold = settings.confidenceThreshold ?? 80;
                
                // Update UI
                document.getElementById('soundToggle').checked = notificationSoundEnabled;
                document.getElementById('autoPredictToggle').checked = autoPredict;
                document.getElementById('intervalSlider').value = autoPredictInterval / 1000;
                document.getElementById('intervalValue').textContent = `${autoPredictInterval / 1000} seconds`;
                document.getElementById('confidenceSlider').value = confidenceThreshold;
                document.getElementById('confidenceValue').textContent = `${confidenceThreshold}%`;
            }
        }

        // Initialize settings on page load
        document.addEventListener('DOMContentLoaded', loadSettings);
    </script>
</body>
</html>
